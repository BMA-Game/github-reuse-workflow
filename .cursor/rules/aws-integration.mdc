---
description: AWS integration best practices for GitHub Actions workflows
---

# AWS Integration Best Practices

Guidelines for secure and efficient AWS integration in GitHub Actions workflows, specifically for ECR and container deployments.

## Authentication and Security

### IAM Role-Based Authentication
- **Always** use IAM roles with `aws-actions/configure-aws-credentials@v4`
- Avoid long-term access keys in GitHub secrets
- Use OIDC (OpenID Connect) for secure, temporary credentials
- Configure minimal required permissions for the role

### Session Management
- Set appropriate session durations (default: 1200 seconds)
- Use descriptive session names for auditing
- Format: `github-actions-{repo-name}-{workflow-name}`
- Example: `github-actions-my-app-build-image`

### Role Configuration Example
```yaml
- name: Configure AWS Credentials
  uses: aws-actions/configure-aws-credentials@v4
  with:
    aws-region: ${{ inputs.aws-region }}
    role-to-assume: ${{ inputs.role-to-assume }}
    role-session-name: ${{ inputs.role-session-name }}
    role-duration-seconds: ${{ inputs.role-duration-seconds }}
```

## ECR Integration

### Repository Management
- Use consistent naming conventions for ECR repositories
- Configure lifecycle policies for image cleanup
- Enable image vulnerability scanning
- Use private repositories unless public access is required

### Login and Push Strategy
- Use `aws-actions/amazon-ecr-login@v2` for authentication
- Login once per workflow, reuse credentials
- Verify successful login before attempting push operations

### Regional Considerations
- Default to `ap-southeast-1` for regional proximity
- Consider multi-region deployments for high availability
- Use region-specific ECR endpoints

## Permission Requirements

### Minimum ECR Permissions
```json
{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "ecr:GetAuthorizationToken",
        "ecr:BatchCheckLayerAvailability",
        "ecr:GetDownloadUrlForLayer",
        "ecr:BatchGetImage",
        "ecr:InitiateLayerUpload",
        "ecr:UploadLayerPart",
        "ecr:CompleteLayerUpload",
        "ecr:PutImage"
      ],
      "Resource": "*"
    }
  ]
}
```

## Error Handling and Monitoring

### Retry Logic
- Implement retry logic for transient AWS service errors
- Use exponential backoff for rate-limited operations
- Set reasonable timeouts for AWS operations

### Logging and Debugging
- Enable detailed logging for troubleshooting
- Log AWS CLI version and configuration
- Capture and log error responses from AWS services

### Cost Optimization
- Use ARM64 runners with ARM64 images for cost efficiency
- Monitor ECR storage costs and implement cleanup policies
- Consider using ECR Public for open-source projects

## Environment-Specific Configuration

### Development
- Use separate ECR repositories per environment
- Implement tag-based environment separation
- Use shorter session durations for development

### Production
- Implement additional security controls
- Use longer session durations for complex deployments
- Enable AWS CloudTrail for audit logging

## Example Complete AWS Integration

```yaml
- name: Configure AWS Credentials
  uses: aws-actions/configure-aws-credentials@v4
  with:
    aws-region: ap-southeast-1
    role-to-assume: arn:aws:iam::123456789012:role/GitHubActionsRole
    role-session-name: github-actions-build-${{ github.run_id }}
    role-duration-seconds: 1200

- name: Login to Amazon ECR
  id: login-ecr
  uses: aws-actions/amazon-ecr-login@v2

- name: Verify ECR login
  run: |
    echo "ECR registry: ${{ steps.login-ecr.outputs.registry }}"
    aws ecr describe-repositories --region ap-southeast-1
```